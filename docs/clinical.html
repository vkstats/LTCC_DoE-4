<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>1&nbsp; Clinical trials with interference – LTCC Design of Experiments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./networks.html" rel="next">
<link href="./interference.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./interference.html">Experiments with interference</a></li><li class="breadcrumb-item"><a href="./clinical.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Clinical trials with interference</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Week 4: Interference and Multi-Objective Experimentation</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./interference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Experiments with interference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./clinical.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Clinical trials with interference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Networked experiments</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./multi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multi-objective experimentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model_robust.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model-robust design and lack-of-fit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./moode.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Multi-objective optimal design of experiments (MOODE)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#cross-over-trials" id="toc-cross-over-trials" class="nav-link active" data-scroll-target="#cross-over-trials"><span class="header-section-number">1.1</span> Cross-over trials</a>
  <ul class="collapse">
  <li><a href="#x2-cross-over-trial" id="toc-x2-cross-over-trial" class="nav-link" data-scroll-target="#x2-cross-over-trial"><span class="header-section-number">1.1.1</span> 2x2 cross-over trial</a></li>
  <li><a href="#larger-cross-over-trials" id="toc-larger-cross-over-trials" class="nav-link" data-scroll-target="#larger-cross-over-trials"><span class="header-section-number">1.1.2</span> Larger cross-over trials</a></li>
  </ul></li>
  <li><a href="#interference-in-other-trials" id="toc-interference-in-other-trials" class="nav-link" data-scroll-target="#interference-in-other-trials"><span class="header-section-number">1.2</span> Interference in other trials</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./interference.html">Experiments with interference</a></li><li class="breadcrumb-item"><a href="./clinical.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Clinical trials with interference</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-clinical" class="quarto-section-identifier"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Clinical trials with interference</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="cross-over-trials" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="cross-over-trials"><span class="header-section-number">1.1</span> Cross-over trials</h2>
<p>The most common form of clinical trial is a <em>parallel group</em> trial, where each subject is allocated to a single treatment, and treatment comparisons are made between the groups. In contrast, in a <strong>cross-over trial</strong>, each subject is assigned a sequence of treatments across different periods. Interest is typically still in comparing individual treatments, not sequences, and the experimental units in such a trial, to which treatments can be applied, are the periods within each subject.</p>
<p>Cross-over trials are common in studies of chronic medical conditions, where repeated treatment of a disease is required. Single subject (“N of 1”) trials are a special case of cross-over trials using a single patient to determine personalised medicine results. Cross-over trials may not be appropriate for trials on acute conditions.</p>
<p>The main advantages of cross-over trials is that each subject acts as their own control, and treatment comparisons can be made “within subject” and hence are less affected by subject-to-subject variability (e.g., caused by unmeasured and unadjusted covariates). Hence, treatment comparisons could be statistically more efficient than when using a parallel group trial.</p>
<p>However, this feature of within subject comparison can also bring disadvantages. Principally,</p>
<ul>
<li>the <strong>order</strong> in which the treatments are applied may impact the outcome, especially if one or more of the treatments have adverse side effects.</li>
<li>most pertinently for us here, there may be <strong>treatment interference</strong> between periods of the design (typically called <em>carry-over</em> in a cross-over trial). That is, the outcome from period <span class="math inline">\(i\)</span> may depend on the treatment applied in period <span class="math inline">\(i-1\)</span> (first-order interference) or even from earlier periods.</li>
</ul>
<p>It is quite common to try to mitigate potential interference by building in wash-out periods between treatment periods in the trial, to allow the subjects to recover from each treatment. However, ensuring this is effective requires knowledge of the pharmacodynamics of the different treatments which may be unknown or uncertain. In some studies, it may not be ethical to pause treatment for a wash-out. Therefore, it is wise to plan for the possibility of interference in the design and analysis of the trial.</p>
<p>Methodology for the design and analysis of cross-over trials is discussed in the book by <span class="citation" data-cites="jk2015">Jones and Kenwood (<a href="references.html#ref-jk2015" role="doc-biblioref">2015</a>)</span> and the review chapter by <span class="citation" data-cites="bd2015">Bose and Dey (<a href="references.html#ref-bd2015" role="doc-biblioref">2015</a>)</span>.</p>
<section id="x2-cross-over-trial" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="x2-cross-over-trial"><span class="header-section-number">1.1.1</span> 2x2 cross-over trial</h3>
<p>The simplest form of cross-over design concerns <span class="math inline">\(t=2\)</span> treatments and <span class="math inline">\(p=2\)</span> periods, the so-called <span class="math inline">\(2\times 2\)</span> trial. There are clearly only two possible sequences, see <a href="#tbl-AB" class="quarto-xref">Table&nbsp;<span>1.1</span></a>, and each subject in the trial is randomised to one of the two. As discussed above, a wash-out period is usually inserted between the two treatment periods.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>AB <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sequence =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>)),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">period =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">trt =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>AB <span class="sc">|&gt;</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> period, <span class="at">values_from =</span> trt) <span class="sc">|&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Sequence"</span>, <span class="fu">paste</span>(<span class="st">"Period"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="fu">rep</span>(<span class="st">"c"</span>, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-AB" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-AB-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.1: Sequences for a 2x2 cross-over trial.
</figcaption>
<div aria-describedby="tbl-AB-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">Sequence</th>
<th style="text-align: center;">Period 1</th>
<th style="text-align: center;">Period 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">B</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">A</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>An example of a <span class="math inline">\(2\times 2\)</span> trial to investigate the efficacy of an inhaled drug (A), compared to a control (B), for patients suffering from chronic obstructive pulmonary disease (COPD). Subjects used either A or B twice daily for four weeks (period 1) before switching to the other treatment for the following four weeks. The response was the mean expiratory flow rate (PEFR) based on readings recorded each morning by the subjects. Data for 54 subjects enrolled in the trial are given in <a href="#tbl-pefr" class="quarto-xref">Table&nbsp;<span>1.2</span></a>. The first 27 subjects had been randomised to the sequence AB, and next 27 to the sequence BA.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pefr <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"pefr.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">54</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>pefr_AB <span class="ot">&lt;-</span> pefr <span class="sc">|&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sequence <span class="sc">==</span> <span class="st">"AB"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>pefr_BA <span class="ot">&lt;-</span> pefr <span class="sc">|&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sequence <span class="sc">==</span> <span class="st">"BA"</span>) </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(pefr_AB, pefr_BA) <span class="sc">|&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">8</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Subject"</span>, <span class="st">"Period 1"</span>, <span class="st">"Period 2"</span>), <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">"Sequence AB"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"Sequence BA"</span> <span class="ot">=</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-pefr" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pefr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.2: Mean morning PEFR (L/min) from a <span class="math inline">\(2\times 2\)</span> cross-over trial <span class="citation" data-cites="jk2015">(adapted from <a href="references.html#ref-jk2015" role="doc-biblioref">Jones and Kenwood, 2015</a>, ch.&nbsp;2)</span>.
</figcaption>
<div aria-describedby="tbl-pefr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Sequence AB
</div></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Sequence BA
</div></th>
</tr>
<tr class="even">
<th style="text-align: right;" data-quarto-table-cell-role="th">Subject</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Period 1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Period 2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Subject</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Period 1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Period 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">121.905</td>
<td style="text-align: right;">116.667</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">138.333</td>
<td style="text-align: right;">138.571</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">218.500</td>
<td style="text-align: right;">200.500</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">225.000</td>
<td style="text-align: right;">256.250</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">235.000</td>
<td style="text-align: right;">217.143</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">392.857</td>
<td style="text-align: right;">381.429</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">250.000</td>
<td style="text-align: right;">196.429</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">190.000</td>
<td style="text-align: right;">233.333</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">186.190</td>
<td style="text-align: right;">185.500</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">191.429</td>
<td style="text-align: right;">228.000</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">231.563</td>
<td style="text-align: right;">221.842</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">226.190</td>
<td style="text-align: right;">267.143</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">443.250</td>
<td style="text-align: right;">420.500</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">201.905</td>
<td style="text-align: right;">193.500</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">198.421</td>
<td style="text-align: right;">207.692</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">134.286</td>
<td style="text-align: right;">128.947</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">270.500</td>
<td style="text-align: right;">213.158</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">238.000</td>
<td style="text-align: right;">248.500</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">360.476</td>
<td style="text-align: right;">384.000</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">159.500</td>
<td style="text-align: right;">140.000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">229.750</td>
<td style="text-align: right;">188.250</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">232.750</td>
<td style="text-align: right;">276.563</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">159.091</td>
<td style="text-align: right;">221.905</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">172.308</td>
<td style="text-align: right;">170.000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: right;">255.882</td>
<td style="text-align: right;">253.571</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">266.000</td>
<td style="text-align: right;">305.000</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: right;">279.048</td>
<td style="text-align: right;">267.619</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">171.333</td>
<td style="text-align: right;">186.333</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: right;">160.556</td>
<td style="text-align: right;">163.000</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">194.737</td>
<td style="text-align: right;">191.429</td>
</tr>
<tr class="even">
<td style="text-align: right;">16</td>
<td style="text-align: right;">172.105</td>
<td style="text-align: right;">182.381</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">200.000</td>
<td style="text-align: right;">222.619</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: right;">267.000</td>
<td style="text-align: right;">313.000</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">146.667</td>
<td style="text-align: right;">183.810</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: right;">230.750</td>
<td style="text-align: right;">211.111</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">208.000</td>
<td style="text-align: right;">241.667</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: right;">271.190</td>
<td style="text-align: right;">257.619</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">208.750</td>
<td style="text-align: right;">218.810</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: right;">276.250</td>
<td style="text-align: right;">222.105</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">271.429</td>
<td style="text-align: right;">225.000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">21</td>
<td style="text-align: right;">398.750</td>
<td style="text-align: right;">404.000</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">143.810</td>
<td style="text-align: right;">188.500</td>
</tr>
<tr class="even">
<td style="text-align: right;">22</td>
<td style="text-align: right;">67.778</td>
<td style="text-align: right;">70.278</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">104.444</td>
<td style="text-align: right;">135.238</td>
</tr>
<tr class="odd">
<td style="text-align: right;">23</td>
<td style="text-align: right;">195.000</td>
<td style="text-align: right;">223.158</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">145.238</td>
<td style="text-align: right;">152.857</td>
</tr>
<tr class="even">
<td style="text-align: right;">24</td>
<td style="text-align: right;">325.000</td>
<td style="text-align: right;">306.667</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">215.385</td>
<td style="text-align: right;">240.476</td>
</tr>
<tr class="odd">
<td style="text-align: right;">25</td>
<td style="text-align: right;">368.077</td>
<td style="text-align: right;">362.500</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">306.000</td>
<td style="text-align: right;">288.333</td>
</tr>
<tr class="even">
<td style="text-align: right;">26</td>
<td style="text-align: right;">228.947</td>
<td style="text-align: right;">227.895</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">160.526</td>
<td style="text-align: right;">150.476</td>
</tr>
<tr class="odd">
<td style="text-align: right;">27</td>
<td style="text-align: right;">236.667</td>
<td style="text-align: right;">220.000</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">353.810</td>
<td style="text-align: right;">369.048</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>The traditional linear model used with cross-over experiments contains terms corresponding to subjects, period, treatment and interference:</p>
<p><span id="eq-crossmod"><span class="math display">\[
\begin{split}
y_{ij} = \mu + \alpha_i + \beta_j + \tau_{r(i,j)} + \rho_{r(i-1,j)} + \varepsilon_{ij}\,,\\ i = 1,\ldots,p;\, j = 1,\ldots, n\,,
\end{split}
\tag{1.1}\]</span></span></p>
<p>where <span class="math inline">\(y_{ij}\)</span> is the response from the <span class="math inline">\(j\)</span>th subject in the <span class="math inline">\(i\)</span>th period, <span class="math inline">\(r(i,j) \in \{1,\ldots,t\}\)</span> denotes the treatment allocated to the <span class="math inline">\(j\)</span>th subject in the <span class="math inline">\(i\)</span>th period, <span class="math inline">\(\mu\)</span> is a general mean, <span class="math inline">\(\alpha_i\)</span> is the <span class="math inline">\(i\)</span>th period effect, <span class="math inline">\(\beta_j\)</span> is the <span class="math inline">\(j\)</span>th subject effect, <span class="math inline">\(\tau_{r(i,j)}\)</span> is the direct effect of treatment <span class="math inline">\(r(i,j)\)</span> and <span class="math inline">\(\rho_{r(i-1,j)}\)</span> is the interference (indirect, carry-over) effect of treatment <span class="math inline">\(r(i-1,j)\)</span>. We define indirect effect <span class="math inline">\(\rho_{r(0,j)}=0\)</span>, for <span class="math inline">\(j=1,\ldots,n\)</span>, to reflect the lack of interference in period 1. The error terms <span class="math inline">\(\varepsilon_{ij}\)</span> are uncorrelated random variables with zero mean and constant variance <span class="math inline">\(\sigma^2\)</span>.</p>
<p>Before we fit model (<a href="#eq-crossmod" class="quarto-xref"><span>1.1</span></a>), it is informative to fit related models corresponding to different experiment formulations and assumptions. We start by fitting the model</p>
<!--
$$
y_{ij} = \mu + \alpha_i + \beta_j + \rho_{r(i-1,j)} + \varepsilon_{ij}\,,\quad i = 1,\ldots,p;\, j = 1,\ldots, n\,,
$$
-->
<p><span class="math display">\[
\begin{split}
y_{ij} = \mu + \alpha_i + \psi_{k} + \beta_{j^\prime|k} +  + \varepsilon_{ij}\,,\\
i = 1,\ldots,p;\, j^\prime = 1,\ldots, n/s;\, k = 1,\ldots, s\,,
\end{split}
\]</span> which investigates the effects <span class="math inline">\(\psi_k\)</span> of the <span class="math inline">\(s\)</span> <em>sequences</em> in the design, as a significant sequence effect, adjusted for a period effect, arises from an indirect treatment effect. Here, subject is now nested within sequence. This is equivalent to a parallel group trial to compare sequences on 54 subjects and hence, as sequences can only be compared <em>between</em> subjects, the correct error mean square for testing for a sequence difference is the between subjects residual, with 53 degrees of freedom, see <a href="#tbl-pefr-parallel" class="quarto-xref">Table&nbsp;<span>1.3</span></a>. There is no evidence of a difference between sequences or, equivalently, no difference in interference between the two treatments. However, in general this test usually has very low power due to large subjec-to-subject variation. Hence we must be cautious in assuming a lack of statistical significance also means a lack of substantive interference. For the PEFR experiment, the clinicians did not expect treatment interference and hence we take lack of statistical significance as evidence for no carry-over.</p>
<p>Note that the test in <a href="#tbl-pefr-parallel" class="quarto-xref">Table&nbsp;<span>1.3</span></a> is (indirectly) testing <span class="math inline">\(\rho_1 = \rho_2\)</span>, and not <span class="math inline">\(\rho_1=\rho_2=0\)</span>. Hence, conclusions are being drawn about equality of interference from the two treatments, not about the presence or absence of treatment interference.</p>
<!-- Subject nested within sequence -->
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pefr_long <span class="ot">&lt;-</span> pefr <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"period"</span>), <span class="at">names_to =</span> <span class="st">"period"</span>, <span class="at">values_to =</span> <span class="st">"pefr"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>pefr_long <span class="ot">&lt;-</span>  pefr_long <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    sequence <span class="sc">==</span> <span class="st">"AB"</span> <span class="sc">&amp;</span> period <span class="sc">==</span> <span class="st">"period_1"</span> <span class="sc">~</span> <span class="st">"A"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    sequence <span class="sc">==</span> <span class="st">"AB"</span> <span class="sc">&amp;</span> period <span class="sc">==</span> <span class="st">"period_2"</span> <span class="sc">~</span> <span class="st">"B"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    sequence <span class="sc">==</span> <span class="st">"BA"</span> <span class="sc">&amp;</span> period <span class="sc">==</span> <span class="st">"period_1"</span> <span class="sc">~</span> <span class="st">"B"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">"A"</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subject =</span> <span class="fu">as.factor</span>(subject))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>pefr_parallel <span class="ot">&lt;-</span> <span class="fu">aov</span>(pefr <span class="sc">~</span> sequence <span class="sc">+</span> period <span class="sc">+</span> <span class="fu">Error</span>(subject), <span class="at">data =</span> pefr_long)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(pefr_parallel) <span class="sc">|&gt;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"between subject residual"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"within subject residual"</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.default =</span> term)) <span class="sc">|&gt;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>stratum) <span class="sc">|&gt;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="at">digits =</span> <span class="dv">3</span>))) <span class="sc">|&gt;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"df"</span>, <span class="st">"Sum Sq."</span>, <span class="st">"Mean Sq."</span>, <span class="st">"F-value"</span>, <span class="st">"P-value"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-pefr-parallel" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pefr-parallel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.3: Analysis of variance from PEFR parallel trial
</figcaption>
<div aria-describedby="tbl-pefr-parallel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">Sum Sq.</th>
<th style="text-align: right;">Mean Sq.</th>
<th style="text-align: right;">F-value</th>
<th style="text-align: right;">P-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sequence</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">21834.440</td>
<td style="text-align: right;">21834.440</td>
<td style="text-align: right;">2.013</td>
<td style="text-align: right;">0.162</td>
</tr>
<tr class="even">
<td style="text-align: left;">between subject residual</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">563973.220</td>
<td style="text-align: right;">10845.639</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">period</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">313.444</td>
<td style="text-align: right;">313.444</td>
<td style="text-align: right;">0.825</td>
<td style="text-align: right;">0.368</td>
</tr>
<tr class="even">
<td style="text-align: left;">within subject residual</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">20144.971</td>
<td style="text-align: right;">380.094</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>A standard two period crossover trial cannot allow for complete balance in the sense of each treatment following every other <em>including itself</em> (we have no cases of treatment A following A or B following B). Hence, when testing for a treatment difference we do need the assumption of no interference, <span class="math inline">\(\rho_{1} = \rho_2\)</span>, to ensure the least squares estimate <span class="math inline">\(\hat{\tau}_1 - \hat{\tau}_2\)</span> is unbiased. If there is evidence of unequal treatment interference, we can use the data from one period only and estimate the treatment difference as if from a parallel group design. However, such an analysis will have much lower power.</p>
<p>Assuming we are happy with the evidence supporting assumption of equal treatment interference, the experiment could also be analysed as a row-column design, using</p>
<p><span class="math display">\[
y_{ij} = \mu + \alpha_i + \beta_j + \tau_{r(i,j)} + \varepsilon_{ij}\,,\quad i = 1,\ldots,p;\, j = 1,\ldots, n\,.
\]</span> The corresponding analysis of variance is given in <a href="#tbl-pefr-rc" class="quarto-xref">Table&nbsp;<span>1.4</span></a>, and shows a significant difference between treatments A and B.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>pefr_rc <span class="ot">&lt;-</span> <span class="fu">aov</span>(pefr <span class="sc">~</span> period <span class="sc">+</span> trt <span class="sc">+</span> <span class="fu">Error</span>(subject), <span class="at">data =</span> pefr_long)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(pefr_rc) <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"subjects"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"treatment"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.default =</span> term)) <span class="sc">|&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>stratum) <span class="sc">|&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="at">digits =</span> <span class="dv">3</span>))) <span class="sc">|&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"df"</span>, <span class="st">"Sum Sq."</span>, <span class="st">"Mean Sq."</span>, <span class="st">"F-value"</span>, <span class="st">"P-value"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-pefr-rc" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pefr-rc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.4: Analysis of variance from PEFR row-column trial
</figcaption>
<div aria-describedby="tbl-pefr-rc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">Sum Sq.</th>
<th style="text-align: right;">Mean Sq.</th>
<th style="text-align: right;">F-value</th>
<th style="text-align: right;">P-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">subjects</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">585807.660</td>
<td style="text-align: right;">11052.975</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">period</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">313.444</td>
<td style="text-align: right;">313.444</td>
<td style="text-align: right;">0.936</td>
<td style="text-align: right;">0.338</td>
</tr>
<tr class="odd">
<td style="text-align: left;">treatment</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2723.059</td>
<td style="text-align: right;">2723.059</td>
<td style="text-align: right;">8.128</td>
<td style="text-align: right;">0.006</td>
</tr>
<tr class="even">
<td style="text-align: left;">Residuals</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">17421.912</td>
<td style="text-align: right;">335.037</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Bringing together these different aspects, model (<a href="#eq-crossmod" class="quarto-xref"><span>1.1</span></a>) can be fitted, resulting in the analysis of variance in <a href="#tbl-pefr-co" class="quarto-xref">Table&nbsp;<span>1.5</span></a> combining the tests performed above.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pefr_co <span class="ot">&lt;-</span> <span class="fu">aov</span>(pefr <span class="sc">~</span> sequence <span class="sc">+</span> period <span class="sc">+</span> trt <span class="sc">+</span> <span class="fu">Error</span>(subject), <span class="at">data =</span> pefr_long)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(pefr_co) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"sequence (interference)"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"between subject residual"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"treatment"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"within subject residual"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.default =</span> term)) <span class="sc">|&gt;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>stratum) <span class="sc">|&gt;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="at">digits =</span> <span class="dv">3</span>))) <span class="sc">|&gt;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"df"</span>, <span class="st">"Sum Sq."</span>, <span class="st">"Mean Sq."</span>, <span class="st">"F-value"</span>, <span class="st">"P-value"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-pefr-co" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pefr-co-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.5: Analysis of variance from PEFR cross-over trial
</figcaption>
<div aria-describedby="tbl-pefr-co-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">Sum Sq.</th>
<th style="text-align: right;">Mean Sq.</th>
<th style="text-align: right;">F-value</th>
<th style="text-align: right;">P-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sequence (interference)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">21834.440</td>
<td style="text-align: right;">21834.440</td>
<td style="text-align: right;">2.013</td>
<td style="text-align: right;">0.162</td>
</tr>
<tr class="even">
<td style="text-align: left;">between subject residual</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">563973.220</td>
<td style="text-align: right;">10845.639</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">period</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">313.444</td>
<td style="text-align: right;">313.444</td>
<td style="text-align: right;">0.936</td>
<td style="text-align: right;">0.338</td>
</tr>
<tr class="even">
<td style="text-align: left;">treatment</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2723.059</td>
<td style="text-align: right;">2723.059</td>
<td style="text-align: right;">8.128</td>
<td style="text-align: right;">0.006</td>
</tr>
<tr class="odd">
<td style="text-align: left;">within subject residual</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">17421.912</td>
<td style="text-align: right;">335.037</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="larger-cross-over-trials" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="larger-cross-over-trials"><span class="header-section-number">1.1.2</span> Larger cross-over trials</h3>
<p>The design of a <span class="math inline">\(2\times 2\)</span> trial is very simple. For larger numbers of treatments and periods, decisions are required on which sequences should be used.</p>
<p>A <strong>balanced</strong> cross-over design has each treatment occuring the same number of times in each period, and each treatment follows every other treatment the same number of times, with no treatment following itself. Such a design has the property that every pair of estimated direct treatment differences, <span class="math inline">\(\hat{\tau}_k = \hat{\tau}_l\)</span> has the same variance.</p>
<p>For <span class="math inline">\(p=t\)</span> (number of periods equal to number of treatments), such designs can be constructed by combining complete sets of <span class="math inline">\(t-1\)</span> orthogonal Latin squares <span class="citation" data-cites="john1971">(<a href="references.html#ref-john1971" role="doc-biblioref">John, 1971</a>, ch.&nbsp;6)</span>, see <a href="#tbl-orthLS" class="quarto-xref">Table&nbsp;<span>1.6</span></a> for the design when <span class="math inline">\(p=t=4\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ABCD1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sequence =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">4</span>)),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">period =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">trt =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"D"</span>, <span class="st">"C"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"D"</span>, <span class="st">"C"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>ABCD2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sequence =</span> <span class="fu">rep</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">4</span>)),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">period =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">trt =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"D"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"A"</span>, <span class="st">"D"</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>          <span class="st">"C"</span>, <span class="st">"B"</span>, <span class="st">"D"</span>, <span class="st">"A"</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>          <span class="st">"D"</span>, <span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"B"</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>ABCD3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">sequence =</span> <span class="fu">rep</span>(<span class="dv">9</span><span class="sc">:</span><span class="dv">12</span>, <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">4</span>)),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">period =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">trt =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"B"</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>          <span class="st">"B"</span>, <span class="st">"D"</span>, <span class="st">"C"</span>, <span class="st">"A"</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>          <span class="st">"C"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"D"</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>          <span class="st">"D"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"C"</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(ABCD1, ABCD2, ABCD3) <span class="sc">|&gt;</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> period, <span class="at">values_from =</span> trt) <span class="sc">|&gt;</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Sequence"</span>, <span class="fu">paste</span>(<span class="st">"Period"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="fu">rep</span>(<span class="st">"c"</span>, <span class="dv">5</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>), <span class="at">extra_css =</span> <span class="st">"border-bottom: 2px solid"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>), <span class="at">hline_after =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-orthLS" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-orthLS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.6: Orthogonal Latin square design for four treatments.
</figcaption>
<div aria-describedby="tbl-orthLS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Sequence</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Period 1</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Period 2</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Period 3</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Period 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">D</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">C</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">B</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 2px solid;">4</td>
<td style="text-align: center; border-bottom: 2px solid;">D</td>
<td style="text-align: center; border-bottom: 2px solid;">C</td>
<td style="text-align: center; border-bottom: 2px solid;">B</td>
<td style="text-align: center; border-bottom: 2px solid;">A</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">C</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">D</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">A</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 2px solid;">8</td>
<td style="text-align: center; border-bottom: 2px solid;">D</td>
<td style="text-align: center; border-bottom: 2px solid;">A</td>
<td style="text-align: center; border-bottom: 2px solid;">C</td>
<td style="text-align: center; border-bottom: 2px solid;">B</td>
</tr>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">B</td>
</tr>
<tr class="even">
<td style="text-align: center;">10</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">A</td>
</tr>
<tr class="odd">
<td style="text-align: center;">11</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">D</td>
</tr>
<tr class="even">
<td style="text-align: center;">12</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">C</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>However, designs constructed in this way require a large number of sequences and are not very flexible. They may also lead to unncessarily large designs; e.g., using the squares from <a href="#tbl-orthLS" class="quarto-xref">Table&nbsp;<span>1.6</span></a> requires the total number of subjects to be a multiple of 12. <span class="citation" data-cites="williams1949">Williams (<a href="references.html#ref-williams1949" role="doc-biblioref">1949</a>)</span> showed that balanced designs could be achieved using much smaller numbers of sequences. An example for <span class="math inline">\(p=t=4\)</span> with only four sequences is given in <a href="#tbl-balLS" class="quarto-xref">Table&nbsp;<span>1.7</span></a>. This design uses many fewer sequences and could be employed with the number of subjects being a multiple of four.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>bal_ABCD <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sequence =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">4</span>)),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">period =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">trt =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"D"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">"C"</span>, <span class="st">"B"</span>, <span class="st">"D"</span>, <span class="st">"A"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"D"</span>, <span class="st">"C"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>bal_ABCD <span class="sc">|&gt;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> period, <span class="at">values_from =</span> trt) <span class="sc">|&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Sequence"</span>, <span class="fu">paste</span>(<span class="st">"Period"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="fu">rep</span>(<span class="st">"c"</span>, <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-balLS" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-balLS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.7: Balanced Latin square design for four treatments.
</figcaption>
<div aria-describedby="tbl-balLS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">Sequence</th>
<th style="text-align: center;">Period 1</th>
<th style="text-align: center;">Period 2</th>
<th style="text-align: center;">Period 3</th>
<th style="text-align: center;">Period 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">C</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">D</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">A</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">B</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Such balanced designs still cannot orthogonally estimate the direct and indirect treatment effects, as no treatment is followed by itself. A <strong>strongly balanced</strong> design is defined as one in which every treatment followed by every other treatment, including itself. In such a design, direct and indirect effects are estimated independently, simplifying the analysis and interpretation, and lowering the variance of estimators of the indirect effects.</p>
<p>If more than <span class="math inline">\(t\)</span> periods are possible, a simple way to generate such a design is to add an extra period that repeats the last period in a design with <span class="math inline">\(p=t\)</span> <span class="citation" data-cites="lucas1957">Lucas (<a href="references.html#ref-lucas1957" role="doc-biblioref">1957</a>)</span>, see the example in <a href="#tbl-strbalLS" class="quarto-xref">Table&nbsp;<span>1.8</span></a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>strbal_ABCD <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sequence =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="fu">rep</span>(<span class="dv">5</span>, <span class="dv">4</span>)),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">period =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">4</span>),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">trt =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"D"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"C"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"D"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">"C"</span>, <span class="st">"B"</span>, <span class="st">"D"</span>, <span class="st">"A"</span>, <span class="st">"A"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"D"</span>, <span class="st">"C"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>strbal_ABCD <span class="sc">|&gt;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> period, <span class="at">values_from =</span> trt) <span class="sc">|&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Sequence"</span>, <span class="fu">paste</span>(<span class="st">"Period"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)),</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="fu">rep</span>(<span class="st">"c"</span>, <span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-strbalLS" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-strbalLS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.8: Strongly balanced extra-period design for four treatments.
</figcaption>
<div aria-describedby="tbl-strbalLS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">Sequence</th>
<th style="text-align: center;">Period 1</th>
<th style="text-align: center;">Period 2</th>
<th style="text-align: center;">Period 3</th>
<th style="text-align: center;">Period 4</th>
<th style="text-align: center;">Period 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">C</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">D</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">A</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">B</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Most standard construction methods for cross-over trials are combinatoric. However, designs can also be found via numerical optimisation, based on some optimality criteria. Often, this is the only approach for arbitrary numbers of treatments and periods, and for extensions to the traditional linear model (e.g., using mixed effect models).</p>
</section>
</section>
<section id="interference-in-other-trials" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="interference-in-other-trials"><span class="header-section-number">1.2</span> Interference in other trials</h2>
<p>Interference can also occur in other trials, including parallel group trials without repeated treatment applications<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Many examples occur in assessing public health interventions, where treatments are applied in the community and community members may interact. The links governing the interference may be much more complex than the simple, directed links in a cross-over trial.</p>
<p>One mitigating strategy is the application of a <strong>cluster randomised</strong> trial (CRT), where all subjects in a cluster or group recieve the same treatment. While there are many other reasons to conduct a CRT (e.g., for practical or ethical purposes), typically clusters will be designed to limit possible treatment contamination between clusters (e.g., due to geographical distance). Within a cluster, all subjects will have received the same treatment, limiting the impact of interference.</p>
<p>In other trials, the indirect effect of each treatment may be of interest in itself. A common case are vaccine trials, where the indirect protection provided by the vaccine is important. Then, methods are required for the design and modelling of experiments to estimate indirect and total effects <span class="citation" data-cites="hh2012">(<a href="references.html#ref-hh2012" role="doc-biblioref">Hudgens and Halloran, 2008</a>)</span>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-bd2015" class="csl-entry" role="listitem">
Bose, M. and Dey, A. (2015) Crossover designs. In <em>Handbook of the Design and Analysis of Experiments</em>, pp. 159–196.
</div>
<div id="ref-hh2012" class="csl-entry" role="listitem">
Hudgens, M. G. and Halloran, M. E. (2008) Toward causal inference with interference. <em>Journal of the American Statistical Association</em>, <strong>103</strong>, 832–842.
</div>
<div id="ref-john1971" class="csl-entry" role="listitem">
John, P. W. (1971) <em>Statistical Design and Analysis of Experiments</em>. Macmillan.
</div>
<div id="ref-jk2015" class="csl-entry" role="listitem">
Jones, B. and Kenwood, M. G. (2015) <em>Design and Analysis of Cross-over Trials</em>. Chapman &amp; Hall/CRC Press.
</div>
<div id="ref-lucas1957" class="csl-entry" role="listitem">
Lucas, H. L. (1957) Extra-period latin-square change over designs. <em>Journal of Dairy Science</em>, <strong>40</strong>, 225–239.
</div>
<div id="ref-williams1949" class="csl-entry" role="listitem">
Williams, E. J. (1949) Experimental designs balanced for the estimation of residual effects of treatments. <em>Australian Journal of Scientific Research</em>, <strong>2</strong>, 149–168.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p><a href="https://clusterrandomisedtrials.qmul.ac.uk" class="uri">https://clusterrandomisedtrials.qmul.ac.uk</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./interference.html" class="pagination-link" aria-label="Experiments with interference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Experiments with interference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./networks.html" class="pagination-link" aria-label="Networked experiments">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Networked experiments</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Vasiliki Koutra (KCL)</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>