<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Networked experiments â€“ LTCC Design of Experiments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./multi.html" rel="next">
<link href="./clinical.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./interference.html">Experiments with interference</a></li><li class="breadcrumb-item"><a href="./networks.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Networked experiments</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Week 4: Interference and Multi-Objective Experimentation</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./interference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Experiments with interference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./clinical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Clinical trials with interference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./networks.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Networked experiments</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./multi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multi-objective experimentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model_robust.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model-robust design and lack-of-fit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./moode.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Multi-objective optimal design of experiments (MOODE)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link active" data-scroll-target="#preliminaries"><span class="header-section-number">2.1</span> Preliminaries</a></li>
  <li><a href="#optimal-designs-for-networked-experiments" id="toc-optimal-designs-for-networked-experiments" class="nav-link" data-scroll-target="#optimal-designs-for-networked-experiments"><span class="header-section-number">2.2</span> Optimal designs for networked experiments</a>
  <ul class="collapse">
  <li><a href="#linear-network-model" id="toc-linear-network-model" class="nav-link" data-scroll-target="#linear-network-model"><span class="header-section-number">2.2.1</span> Linear network model</a></li>
  <li><a href="#optimality-criteria" id="toc-optimality-criteria" class="nav-link" data-scroll-target="#optimality-criteria"><span class="header-section-number">2.2.2</span> Optimality criteria</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">2.2.3</span> Examples</a></li>
  </ul></li>
  <li><a href="#sec-field" id="toc-sec-field" class="nav-link" data-scroll-target="#sec-field"><span class="header-section-number">2.3</span> Case study: agricultural experiment</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./interference.html">Experiments with interference</a></li><li class="breadcrumb-item"><a href="./networks.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Networked experiments</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-network" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Networked experiments</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!--
more complex interfence, e.g., from a general network structure; LNM and extensions; examples to illustrate challenges and methods; future work (causal inference, tech applications, large networks).
-->
<p>A variety of different experiments from outside the clinical arena can also violate SUTVA due to treatment interference arising from connections between experimental units. One common example is online controlled experiments performed, e.g., by technology companies to assess features on websites and social media platforms <span class="citation" data-cites="lssdks2024">(<a href="references.html#ref-lssdks2024" role="doc-biblioref">Larsen <em>et al.</em>, 2024</a>)</span>. Connections between users on these platforms can lead to treatment interference, e.g., by sharing positive or negative experiences. In this vein, <a href="#fig-facebook" class="quarto-xref">Figure&nbsp;<span>2.1</span></a> shows a small subset of the Facebook network, comprising 2514 connections between 324 user. Experimentation on such a network via the application of treatments to users would be susceptible to interference, e.g.&nbsp;via discussions using instant messaging.</p>
<p>Further, there could be distinct communities within the network, with more similar responses expected from users in the same community as opposed to from different communities. In the Facebook network, example communities are indicated by difference colours. Such communities should be incorporated into the design and analysis as a blocking factor.</p>
<div id="fig-facebook" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-facebook-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/spectral_clustering.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-facebook-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.1: Subset of the <a href="http://snap.stanford.edu/data/egonets-Facebook.html">Facebook network</a> from the Stanford Data Collection, Colours inducated 24 distinct blocks, or communities, of users.
</figcaption>
</figure>
</div>
<p>In addition to the technology industry, networked experiments can be found in many other fields. Indicative examples are given in <a href="#tbl-netex" class="quarto-xref">Table&nbsp;<span>2.1</span></a>, along with exemplar interventions and connections. One commong feature of these experiments, in common with the clinical trials in <a href="clinical.html" class="quarto-xref"><span>Chapter 1</span></a>: they all involve people (or animals). In general, it is harder to harder to enforce the assumption of SUTVA on experiments in the human sciences as opposed to, for example, the lab-based or physical sciences.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>ex <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">field =</span> <span class="fu">c</span>(<span class="st">"Marketing"</span>, <span class="st">"Agriculture"</span>, <span class="st">"Health"</span>, <span class="st">"Politics"</span>, <span class="st">"Education"</span>, <span class="st">"Ecology"</span>, <span class="st">"Law enforcement"</span>),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">intervention =</span> <span class="fu">c</span>(<span class="st">"Advertisement"</span>, <span class="st">"Pesticide"</span>, <span class="st">"Infection control information"</span>, <span class="st">"Direct mailing"</span>, <span class="st">"Incentivised food choices"</span>, <span class="st">"Reward-based intervention"</span>, <span class="st">"Surveillance"</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">links =</span> <span class="fu">c</span>(<span class="st">"Virtual friendships"</span>, <span class="st">"Geographic proximity"</span>, <span class="st">"Patient contacts in hospital"</span>, <span class="st">"Voter interactions"</span>, <span class="st">"Social links"</span>, <span class="st">"Animal interactions"</span>, <span class="st">"Geographical proximity"</span>),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">response =</span> <span class="fu">c</span>(<span class="st">"Product awareness"</span>, <span class="st">"Crop yield"</span>, <span class="st">"Disease incidence"</span>, <span class="st">"Voting behaviour"</span>, <span class="st">"Snack choice"</span>, <span class="st">"Reaction speed"</span>, <span class="st">"Crime rate"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>ex <span class="sc">|&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Field of study"</span>, <span class="st">"Intervention"</span>, <span class="st">"Connections"</span>, <span class="st">"Response"</span>)  </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-netex" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-netex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.1: Examples of networked experiments.
</figcaption>
<div aria-describedby="tbl-netex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 32%">
<col style="width: 31%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Field of study</th>
<th style="text-align: left;">Intervention</th>
<th style="text-align: left;">Connections</th>
<th style="text-align: left;">Response</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Marketing</td>
<td style="text-align: left;">Advertisement</td>
<td style="text-align: left;">Virtual friendships</td>
<td style="text-align: left;">Product awareness</td>
</tr>
<tr class="even">
<td style="text-align: left;">Agriculture</td>
<td style="text-align: left;">Pesticide</td>
<td style="text-align: left;">Geographic proximity</td>
<td style="text-align: left;">Crop yield</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Health</td>
<td style="text-align: left;">Infection control information</td>
<td style="text-align: left;">Patient contacts in hospital</td>
<td style="text-align: left;">Disease incidence</td>
</tr>
<tr class="even">
<td style="text-align: left;">Politics</td>
<td style="text-align: left;">Direct mailing</td>
<td style="text-align: left;">Voter interactions</td>
<td style="text-align: left;">Voting behaviour</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Education</td>
<td style="text-align: left;">Incentivised food choices</td>
<td style="text-align: left;">Social links</td>
<td style="text-align: left;">Snack choice</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ecology</td>
<td style="text-align: left;">Reward-based intervention</td>
<td style="text-align: left;">Animal interactions</td>
<td style="text-align: left;">Reaction speed</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Law enforcement</td>
<td style="text-align: left;">Surveillance</td>
<td style="text-align: left;">Geographical proximity</td>
<td style="text-align: left;">Crime rate</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<section id="preliminaries" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="preliminaries"><span class="header-section-number">2.1</span> Preliminaries</h2>
<p>Suppose that <span class="math inline">\(n\)</span> experimental units are available for experimentation, formed into a network with connections representing possible routes for treatment interference. This network can be represented as a graph <span class="math inline">\(\mathcal{G} = (\mathcal{V}, \mathcal{E})\)</span> with vertex set <span class="math inline">\(\mathcal{V}\)</span> representing the units and edge set <span class="math inline">\(\mathcal{E}\)</span>, of size <span class="math inline">\(l\)</span>, representing the connections between them. The units might be users of a social network, patients in a clinical setting or plots of agricultural land.</p>
<p>These connections can be succinctly represented via the <strong>adjacency matrix</strong>, <span class="math inline">\(A = [A]_{jh}\)</span>, an <span class="math inline">\(n\times n\)</span> matrix with <span class="math inline">\(A_{jh} = \in [0, 1]\)</span> representing the strength of connection between nodes (units) <span class="math inline">\(j\)</span> and <span class="math inline">\(h\)</span>. We focus on undirected graphs with <span class="math inline">\(A_{jh} = A_{hj}\)</span>. Lack of an edge between nodes <span class="math inline">\(j\)</span> and <span class="math inline">\(h\)</span> in <span class="math inline">\(\mathcal{E}\)</span> leads to <span class="math inline">\(A_{jh} = A_{hj} = 0\)</span>; by convention, <span class="math inline">\(A_{jj}=0\)</span>. A simple example is given in <a href="#tbl-exgraph" class="quarto-xref">Table&nbsp;<span>2.2</span></a> and <a href="#fig-exgraph" class="quarto-xref">Figure&nbsp;<span>2.2</span></a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">nrow =</span> <span class="dv">5</span>, <span class="at">byrow =</span> T</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(A) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(A) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>A <span class="sc">|&gt;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-exgraph" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-exgraph-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.2: Example adjacency matrix for the graph <span class="math inline">\(\mathcal{G}\)</span> in <a href="#fig-exgraph" class="quarto-xref">Figure&nbsp;<span>2.2</span></a> with <span class="math inline">\(|\mathcal{V}| = 5\)</span> vertices and <span class="math inline">\(|\mathcal{E}| = 6\)</span> undirected edges.
</figcaption>
<div aria-describedby="tbl-exgraph-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">A</th>
<th style="text-align: right;">B</th>
<th style="text-align: right;">C</th>
<th style="text-align: right;">D</th>
<th style="text-align: right;">E</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">D</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>A <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">graph_from_adjacency_matrix</span>(<span class="at">mode =</span> <span class="st">"undirected"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">vertex.color =</span> <span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"lightblue"</span>, <span class="st">"lightblue"</span>, <span class="st">"orange"</span>, <span class="st">"orange"</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-exgraph" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exgraph-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="networks_files/figure-html/fig-exgraph-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exgraph-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.2: Example graph <span class="math inline">\(\mathcal{G}\)</span> for the adajcency matrix in <a href="#tbl-exgraph" class="quarto-xref">Table&nbsp;<span>2.2</span></a> with <span class="math inline">\(|\mathcal{V}| = 5\)</span> vertices and <span class="math inline">\(|\mathcal{E}| = 6\)</span> undirected edges. Colours indicate an examplar blocking into two groups.
</figcaption>
</figure>
</div>
</div>
</div>
<p>For some applications, necessary blocking factors may be obvious or based on covariates external to the graph, e.g., age or sex. The colours in <a href="#fig-exgraph" class="quarto-xref">Figure&nbsp;<span>2.2</span></a> illustrate such a case; see also <a href="#sec-field" class="quarto-xref"><span>Section 2.3</span></a>. For others, it may be necessary or desirable to base the blocks on the graph structure itself, e.g., using spectral clustering <span class="citation" data-cites="kgp2021">(<a href="references.html#ref-kgp2021" role="doc-biblioref">Koutra <em>et al.</em>, 2021</a>)</span>.</p>
</section>
<section id="optimal-designs-for-networked-experiments" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="optimal-designs-for-networked-experiments"><span class="header-section-number">2.2</span> Optimal designs for networked experiments</h2>
<section id="linear-network-model" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="linear-network-model"><span class="header-section-number">2.2.1</span> Linear network model</h3>
<p>The adjacency matrix can be used to incorporate indirect treatment effects into a model for the experiment. <span class="citation" data-cites="pgs2016">Parker <em>et al.</em> (<a href="references.html#ref-pgs2016" role="doc-biblioref">2016</a>)</span> and <span class="citation" data-cites="kgp2021">Koutra <em>et al.</em> (<a href="references.html#ref-kgp2021" role="doc-biblioref">2021</a>)</span> developed the linear network effects model, where the response from unit <span class="math inline">\(j\)</span> in block <span class="math inline">\(i\)</span> is modelled with additive block, direct and indirect treatment effects:</p>
<p><span id="eq-bnm"><span class="math display">\[
\begin{split}
y_{ij} = \mu  + \beta_i + \tau_{r(i,j)} + \sum_{g=1}^{b}\sum_{h=1}^{n_{g}} A_{\left\{ij,gh\right\}}\gamma_{r(g,h)} +\varepsilon_{ij}\,, \\
\quad i=1,\ldots,b\,,\,j = 1,\ldots, n_i\,.
\end{split}
\tag{2.1}\]</span></span></p>
<p>Here, <span class="math inline">\(\beta_i\)</span> is the <span class="math inline">\(i\)</span>th block effect, <span class="math inline">\(r(i,j)\)</span> is the treatment applied to the <span class="math inline">\(j\)</span>th unit in the <span class="math inline">\(i\)</span>th block, <span class="math inline">\(\tau_k\)</span> and <span class="math inline">\(\gamma_k\)</span> are the direct and indirect effects, respectively, of treatment <span class="math inline">\(k\in\{1,\ldots,t\}\)</span>. Use of the adjacency matrix in <a href="#eq-bnm" class="quarto-xref"><span>2.1</span></a> picks out the correct indirect treatment effects, corresponding to the treatments allocated to connected units.</p>
<p>For the graph in Figure <a href="#fig-exgraph" class="quarto-xref">Figure&nbsp;<span>2.2</span></a>, with adjacency matrix in <a href="#tbl-exgraph" class="quarto-xref">Table&nbsp;<span>2.2</span></a>, the response from node A, the first unit in block 1, would be modelled as:</p>
<p><span class="math display">\[
y_{11} = \mu + \beta_1 + \tau_{r(1,1)} + \gamma_{r(1,2)} + \gamma_{r(1,3)} + \gamma_{r(2,1)} + \varepsilon_{11}\,,
\]</span> with the indirect treatment effects resulting from the edges between node A and nodes D and E (in block 1) and node B (in block 2). The linear network effects model can be estimated using least squares or maximum likelihood, subject to applying suitable parameter constraints or defining a set of estimable contrasts.</p>
</section>
<section id="optimality-criteria" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="optimality-criteria"><span class="header-section-number">2.2.2</span> Optimality criteria</h3>
<p>Two possible aims from the experiment are</p>
<ol type="i">
<li>estimation of pairwise differences between direct treatment effects, or</li>
<li>estimate of pairwise differences between indirect treatment effects, if primary interest is in the viral effects of a treatment.</li>
</ol>
<p>In either case, design selection will be based on model (<a href="#eq-bnm" class="quarto-xref"><span>2.1</span></a>) with direct and indirect treatment effects being mutually adjusted.</p>
<p>For efficient estimation of direct treatment differences, designs are sought that minimise the average variance of the pairwise differences:</p>
<p><span id="eq-phi1"><span class="math display">\[
\phi_{\tau}=\frac{2}{t(t-1)} \sum_{s=1}^{t-1}\sum_{s'=s+1}^t \text{var}(\widehat{\tau_s-\tau_{s'}})\,.
\tag{2.2}\]</span></span></p>
<p>Similarly, we can define a criterion for efficient estimation of indirect treatment differences, that minimises</p>
<p><span id="eq-phi2"><span class="math display">\[
\phi_{\gamma}=\frac{2}{t(t-1)} \sum_{s=1}^{t-1}\sum_{s'=s+1}^t \text{var}(\widehat{\gamma_s-\gamma_{s'}})\,.
\tag{2.3}\]</span></span></p>
<p>If alternative estimable contrasts were of interest, corresponding design selection criteria could be constructed. Designs can be found via application of standard optimisation algorithms, such as point exchange <span class="citation" data-cites="cn1980">(<a href="references.html#ref-cn1980" role="doc-biblioref">Cook and Nachtsheim, 1980</a>)</span>.</p>
</section>
<section id="examples" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="examples"><span class="header-section-number">2.2.3</span> Examples</h3>
<p>As a first example, consider the network shown in <a href="#fig-coauthor" class="quarto-xref">Figure&nbsp;<span>2.3</span></a>, which describes co-authorship links between academics within a university research group <span class="citation" data-cites="kgp2021">(<a href="references.html#ref-kgp2021" role="doc-biblioref">Koutra <em>et al.</em>, 2021</a>)</span>. There are 22 nodes, split into three blocks, and 27 edges. Interest lies in estimating the effects of two treatments.</p>
<div id="fig-coauthor" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-coauthor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/alloc_LNBD_22vert.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-coauthor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.3: Block designs for a co-authorship network with colours indicating blocks (identified via spectral clustering) and plotting symbol indicating allocation to treatment 1 or 2. Left: optimal design for estimation of direct effects. Right: optimal design for estimation of indirect effects.
</figcaption>
</figure>
</div>
<p>The left-hand plot shows the design for estimating the direct effects, with the right-hand plot giving the design for estimating the indirect effects. The designs are not the same, and in general the structure will depend on the network. The <span class="math inline">\(\phi_{\tau}\)</span>-optimal design is balanced, with equal replication of each treatment. Treatment allocation is also balanced within each block. Nodes allocated to each treatment have similar first- and second-order degrees (numbers of connections between nodes of distance one or two). Treatment allocation in the <span class="math inline">\(\phi_{\gamma}\)</span>-optimal design is highly dependent on the network, with highly connected nodes tending to receive a different treatment from their surrounding, less connected, nodes.</p>
<p>Quantitative comparisons can be made between the block network designs (BNDs) from <a href="#fig-coauthor" class="quarto-xref">Figure&nbsp;<span>2.3</span></a> and the optimal designs that would result from models that</p>
<ul>
<li>ignore blocks and network structure (CRD: completely randomised design);</li>
<li>ignore network structure (RBD: randomised block design);</li>
<li>ignore blocks (LND: linear network design).</li>
</ul>
<p><a href="#tbl-coauthor-direct" class="quarto-xref">Table&nbsp;<span>2.3</span></a> gives the efficiencies for estimating direct effects for these various designs under the corresponding models. Each row corresponds to one model: CRM (ignoring blocks and network), RBM (ignoring the network), LNM (ignoring blocks) and BNM (including blocks and network structure). Efficiencies are calculated <strong>within row</strong>; comparisons between rows are not meaningful due to the differing numbers of paramters in the different models.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dir_eff <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">eff =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, .<span class="dv">89</span>, <span class="dv">1</span>, <span class="fl">0.68</span>, <span class="dv">1</span>, <span class="fl">0.86</span>, <span class="fl">0.83</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.73</span>, <span class="fl">0.81</span>, <span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"CRM"</span>, <span class="st">"RBM"</span>, <span class="st">"LNM"</span>, <span class="st">"BNM"</span>), <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">4</span>)),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">des =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"CRD"</span>, <span class="st">"RBD"</span>, <span class="st">"LND"</span>, <span class="st">"BND"</span>), <span class="dv">4</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>dir_eff <span class="sc">|&gt;</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> des, <span class="at">values_from =</span> eff) <span class="sc">|&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">""</span>, <span class="st">"Designs"</span> <span class="ot">=</span> <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-coauthor-direct" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-coauthor-direct-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.3: Efficiencies for estimating the direct treatment effects for designs with and without blocking and/or indirect effects under different model assumptions.
</figcaption>
<div aria-describedby="tbl-coauthor-direct-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="4" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Designs
</div></th>
</tr>
<tr class="even">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CRD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RBD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LND</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BND</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CRM</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">RBM</td>
<td style="text-align: right;">0.89</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.68</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LNM</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">BNM</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>Two features stand out from <a href="#tbl-coauthor-direct" class="quarto-xref">Table&nbsp;<span>2.3</span></a>.</p>
<ol type="i">
<li>The importance of including blocks in the optimal design, if they are present in the model. For example, the LND is only 50% efficient if blocks are added to the model. This is because balance within blocks is not achieved by the LND.</li>
<li>The substantial loss in efficiency if network effects are excluded; e.g., the CRD and RBD lose around ~15-25% efficiency compared to the LND/BND.</li>
</ol>
<p><a href="#tbl-coauthor-indirect" class="quarto-xref">Table&nbsp;<span>2.4</span></a> gives efficiencies for estimating the indirect effects for the four different designs. The loss of efficiency for designs that ignore network structure is now stark (&gt;80%).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dir_eff <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">eff =</span> <span class="fu">c</span>(<span class="fl">0.16</span>, <span class="fl">0.12</span>, <span class="dv">1</span>, <span class="fl">0.64</span>, <span class="fl">0.16</span>, <span class="fl">0.16</span>, <span class="fl">0.39</span>, <span class="dv">1</span>),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"LNM"</span>, <span class="st">"BNM"</span>), <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">2</span>)),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">des =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"CRD"</span>, <span class="st">"RBD"</span>, <span class="st">"LND"</span>, <span class="st">"BND"</span>), <span class="dv">2</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>dir_eff <span class="sc">|&gt;</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> des, <span class="at">values_from =</span> eff) <span class="sc">|&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">""</span>, <span class="st">"Designs"</span> <span class="ot">=</span> <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-coauthor-indirect" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-coauthor-indirect-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.4: Efficiencies for estimating the indirect treatment effects for designs with and without blocking under different model assumptions.
</figcaption>
<div aria-describedby="tbl-coauthor-indirect-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="4" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Designs
</div></th>
</tr>
<tr class="even">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CRD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RBD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LND</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BND</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LNM</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.64</td>
</tr>
<tr class="even">
<td style="text-align: left;">BNM</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">1.00</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>As a second example, we briefly return to the Facebook network in <a href="#fig-facebook" class="quarto-xref">Figure&nbsp;<span>2.1</span></a>. For designs to again estimate two treatments, we find</p>
<ol type="i">
<li>for this network, the CRD and RBD are a little more efficient under <span class="math inline">\(\phi_\tau\)</span> than in the first example, with average efficienices greater than 90%;</li>
<li>under <span class="math inline">\(\phi_\gamma\)</span>, are again very poor with efficiencies less than 20%.</li>
</ol>
<p>For both examples, we see that ignoring important indirect effects resulting from network structure in the design of the experiment will reduce the efficiency of direct treatment effect estimation, and almost prevent effective estimation of any indirect effects.</p>
</section>
</section>
<section id="sec-field" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-field"><span class="header-section-number">2.3</span> Case study: agricultural experiment</h2>
<p>Formal design of experiments methodology was largely developed in the context of agricultural field trials, especially at the Rothamsted research station at Harpenden. This is also an application area where he potential impact of treatment interference has long been recognised and various methods for both modelling and mitigation proposed and applied. In particular, the impact of <em>neighbouring</em> plots was been widely considered, including through indirect treatment effects <span class="citation" data-cites="bk1986">(<a href="references.html#ref-bk1986" role="doc-biblioref">Besag and Kempton, 1986</a>)</span>. A typical layout of a field trial is shown in <a href="#fig-farm" class="quarto-xref">Figure&nbsp;<span>2.4</span></a>, clearly showing the proximity of neighbouring plots.</p>
<div id="fig-farm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-farm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/farm.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-farm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.4: Example field layout, as used at Rothamsted
</figcaption>
</figure>
</div>
<p>We consider experiments conducted at Rothamsted to study the differences in natural cereal aphid colonization of 21 different wheat varieties <span class="citation" data-cites="kgpm2023">(<a href="references.html#ref-kgpm2023" role="doc-biblioref">Koutra <em>et al.</em>, 2023</a>)</span>. Aphids are small insects such on plant sap and can cause considerable crop damage. The experiment was performed in a <span class="math inline">\(14\times 6\)</span> grid of 1m x 1m plots, see <a href="#fig-plots" class="quarto-xref">Figure&nbsp;<span>2.6</span></a> which also gives the allocation of the 21 varieties to plots for an experiment performed in 2016. There are sufficient plots for each treatment to be replicated four times.</p>
<div id="fig-plots" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/plots.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.5: Plot layout for the agricultural example with treatment allocation from the 2016 design. Numbers indicated treatments allocated to each plot.
</figcaption>
</figure>
</div>
<p>Treatment interference was thought possible due to the differing levels of susceptibility of different varieties and the strong possibility of aphids moving from plot to plot. Hence, a plot where a very susceptible variety has been planted may lead to neighbouring plots suffering from direct treatment interference. Differing structures governing this interference were considered, represented as graphs. Here, we focus on network illustrated in <a href="#fig-plots" class="quarto-xref">Figure&nbsp;<span>2.6</span></a>, where the connections between (nodes) plots are inversely weighted by spatial distance.</p>
<div id="fig-plots" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/kings.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.6: Network and optimal design for the wheat field trial. Numbers indicated treatments allocated to each plot.
</figcaption>
</figure>
</div>
<p>In addition to direct and indirect treatment effects, the analysis of the experiment needed to account for the spatial structure through the inclusion of blocking factors and row-column effects. The following model was assumed,</p>
<p><span id="eq-rc"><span class="math display">\[
\begin{aligned}
y_j &amp;=\mu+\tau_{r(j)}+ R_i+C_k+(RC)_{ik}+r_{ig}+c_{kh} \\
&amp; +\left(rC\right)_{igk}+\left(Rc\right)_{ikh} +\sum_{j'} A_{jj'}  \gamma_{r(j')} + \varepsilon_{j}\,,
\end{aligned}
\tag{2.4}\]</span></span></p>
<p>with <span class="math inline">\(R\)</span>, <span class="math inline">\(C\)</span> and <span class="math inline">\(RC\)</span> representing the effects of super-rows and super-columns, and their interaction (together representing super-blocks). Effects <span class="math inline">\(r\)</span> and <span class="math inline">\(c\)</span> are of rows and columns nested inside super-blocks. An analysis of variance based on this model for the 2016 experiment indicated the possibility of treatment interference, with indirect effects significant even after adjusted for direct treatment effects, see <a href="#tbl-kings_analysis" class="quarto-xref">Table&nbsp;<span>2.5</span></a>. Comparison 1 tests direct effects adjusted for indirect effects, treating the latter as nuisance factors. This comparison is the most relevant for this trial. Comparison 2 tests the impact of indirect effects over and above direct effects, as might be of interest when the viral effects are of primary importance.</p>
<div id="tbl-kings_analysis" class="striped hover quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[33,11,11,11,11,11,11]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-kings_analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.5: Analysis with network effects for the 2016 wheat experiment.
</figcaption>
<div aria-describedby="tbl-kings_analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table-hover caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Sum Sq</th>
<th>Mean Sq</th>
<th>NumDF</th>
<th>DenDF</th>
<th>F-value</th>
<th>p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Comparison 1</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Indirect effect</td>
<td>32.58</td>
<td>1.63</td>
<td>20.00</td>
<td>31.76</td>
<td>3.24</td>
<td>0.0015</td>
</tr>
<tr class="odd">
<td>Direct effect</td>
<td>19.34</td>
<td>0.97</td>
<td>20.00</td>
<td>35.48</td>
<td>1.92</td>
<td>0.0437</td>
</tr>
<tr class="even">
<td>Comparison 2</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Direct effect</td>
<td>32.20</td>
<td>1.61</td>
<td>20.00</td>
<td>35.85</td>
<td>3.20</td>
<td>0.0012</td>
</tr>
<tr class="even">
<td>Indirect effect</td>
<td>20.41</td>
<td>1.02</td>
<td>20.00</td>
<td>32.09</td>
<td>2.03</td>
<td>0.0361</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>An optimal design was sought assuming model (<a href="#eq-rc" class="quarto-xref"><span>2.4</span></a>) to allow efficient estimation of the direct treatment effects, using the <span class="math inline">\(\phi_\tau\)</span>criterion. The design is shown in <a href="#fig-plots" class="quarto-xref">Figure&nbsp;<span>2.6</span></a>. Two features of note are that (i) there is a good spatial spread of treatments, but that (ii) it is also quite common for pairs of connected units to share a treatment. Both these features have been observed in previous row-column and network designs; see <span class="citation" data-cites="freeman1979">Freeman (<a href="references.html#ref-freeman1979" role="doc-biblioref">1979</a>)</span>, <span class="citation" data-cites="pgs2016">Parker <em>et al.</em> (<a href="references.html#ref-pgs2016" role="doc-biblioref">2016</a>)</span> and <span class="citation" data-cites="kgp2021">Koutra <em>et al.</em> (<a href="references.html#ref-kgp2021" role="doc-biblioref">2021</a>)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">eff =</span> <span class="dv">254</span> <span class="sc">/</span> <span class="fu">c</span>(<span class="dv">642</span>, <span class="dv">589</span>, <span class="dv">550</span>, <span class="dv">499</span>, <span class="dv">549</span>, <span class="dv">506</span>, <span class="dv">353</span>, <span class="dv">254</span>), </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> <span class="fu">c</span>(<span class="st">"CRD"</span>, <span class="st">"RBD"</span>, <span class="st">"RCD"</span>, <span class="st">"BRCD"</span>, <span class="st">"LND"</span>, <span class="st">"BND"</span>, <span class="st">"RCND"</span>, <span class="st">"BRCND"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> design, <span class="at">values_from =</span> eff) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rname =</span> <span class="st">"Efficiency"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">"rname"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">""</span>,<span class="st">"Designs"</span> <span class="ot">=</span> <span class="dv">8</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-fieldeff" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-fieldeff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.6: Efficiencies of optimal designs for various submodels of (<a href="#eq-rc" class="quarto-xref"><span>2.4</span></a>) when evaluated under the full model.
</figcaption>
<div aria-describedby="tbl-fieldeff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="8" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Designs
</div></th>
</tr>
<tr class="even">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CRD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RBD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RCD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BRCD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LND</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BND</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RCND</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BRCND</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Efficiency</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.72</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>Ignoring block and network effects when designing the experiment can, once again, have a substantial impact on the efficiency of the design if these effects are then including at the analysis stage. <a href="#tbl-fieldeff" class="quarto-xref">Table&nbsp;<span>2.6</span></a> shows the efficiencies under the <span class="math inline">\(\phi_\tau\)</span>-criterion for various submodel of (<a href="#eq-rc" class="quarto-xref"><span>2.4</span></a>) (BRCND), ranging from a completely randomised design (CRD) that ignores blocks and network effects to a row-column network design that only ignores super-blocks (RCND). All designs lose at least 28% efficiency. Once again, including network effects but ignoring blocks and/or row-columns (LND, BND) is inefficient as the distribution of the treatments across blocks will be sub-optimal, achieving around the same efficiency as the designs which include row-columns and/or blocks but ignore network effects (RCD, BRCD). Clearly, ignoring network effects at the analysis stage, as well as when designing the experiment, could lead to biased estimates of the direct treatment effects.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-bk1986" class="csl-entry" role="listitem">
Besag, J. and Kempton, R. A. (1986) Statistical analysis of field experiments using neighbouring plots. <em>Biometrics</em>, 231â€“251.
</div>
<div id="ref-cn1980" class="csl-entry" role="listitem">
Cook, R. D. and Nachtsheim, C. J. (1980) A comparison of algorithms for constructing exact d-optimal designs. <em>Technometrics</em>, 315â€“324.
</div>
<div id="ref-freeman1979" class="csl-entry" role="listitem">
Freeman, G. H. (1979) Some two-dimensional designs balanced for nearest neighbours. <em>Journal of the Royal Statistical Society B</em>, 88â€“95.
</div>
<div id="ref-kgp2021" class="csl-entry" role="listitem">
Koutra, V., Gilmour, S. G. and Parker, B. M. (2021) Optimal block designs for experiments on networks. <em>Journal of the Royal Statistical Society C</em>, 596â€“618.
</div>
<div id="ref-kgpm2023" class="csl-entry" role="listitem">
Koutra, V., Gilmour, S. G., Parker, B. M., et al. (2023) Design of agricultural field experiments accounting for both complex blocking structures and network effects. <em>Journal of Agricultural, Biological and Environmental Statistics</em>, 526â€“548.
</div>
<div id="ref-lssdks2024" class="csl-entry" role="listitem">
Larsen, N., Stallrich, J., Sengupta, S., et al. (2024) Statistical challenges in online controlled experiments: A review of <span>A/B</span> testing methodology. <em>The American Statistician</em>, <strong>78</strong>, 135â€“149.
</div>
<div id="ref-pgs2016" class="csl-entry" role="listitem">
Parker, B. M., Gilmour, S. G. and Schormans, J. (2016) Optimal design of experiments on connected units with application to social networks. <em>Journal of the Royal Statistical Society C</em>, 455â€“480.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./clinical.html" class="pagination-link" aria-label="Clinical trials with interference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Clinical trials with interference</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./multi.html" class="pagination-link" aria-label="Multi-objective experimentation">
        <span class="nav-page-text">Multi-objective experimentation</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Vasiliki Koutra (KCL)</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>